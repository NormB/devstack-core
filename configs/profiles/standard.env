# ==============================================================================
# DevStack Core - Standard Profile Environment Overrides
# ==============================================================================
#
# This file contains environment variable overrides for the STANDARD profile.
# The standard profile includes full development stack with all databases and
# Redis cluster for production-parity development.
#
# SERVICES INCLUDED (10):
#   All minimal services (vault, postgres, pgbouncer, forgejo, redis-1) PLUS:
#   - mysql:      MySQL 8.0 database
#   - mongodb:    MongoDB 7 NoSQL database
#   - redis-2:    Redis cluster node 2
#   - redis-3:    Redis cluster node 3
#   - rabbitmq:   Message queue with management UI
#
# RESOURCE USAGE:
#   - RAM:        ~4GB
#   - CPU:        4 cores recommended
#   - Disk:       ~10GB for volumes
#   - Startup:    ~45 seconds
#
# USAGE:
#   Source this file before starting services:
#   set -a; source configs/profiles/standard.env; set +a
#   docker compose --profile standard up -d
#
# Or use the management script:
#   ./devstack.py start --profile standard
#
# ==============================================================================

# ------------------------------------------------------------------------------
# Redis Configuration - Cluster Mode (3 Nodes)
# ------------------------------------------------------------------------------
# In standard profile, Redis runs as a 3-node cluster for high availability
# and production parity.

# Enable Redis cluster mode
REDIS_CLUSTER_ENABLED=true

# Redis cluster initialization required after first start
REDIS_CLUSTER_INIT_REQUIRED=true

# Redis node configuration
REDIS_1_HOST_PORT=6379
REDIS_1_TLS_PORT=6390
REDIS_1_CLUSTER_PORT=16379
REDIS_1_IP=172.20.0.13

REDIS_2_HOST_PORT=6380
REDIS_2_TLS_PORT=6391
REDIS_2_CLUSTER_PORT=16380
REDIS_2_IP=172.20.0.16

REDIS_3_HOST_PORT=6381
REDIS_3_TLS_PORT=6392
REDIS_3_CLUSTER_PORT=16381
REDIS_3_IP=172.20.0.17

# Redis cluster slot distribution
# Node 1: slots 0-5460
# Node 2: slots 5461-10922
# Node 3: slots 10923-16383

# Redis memory per node (standard allocation)
REDIS_MAX_MEMORY=256mb
REDIS_MAXMEMORY_POLICY=allkeys-lru

# Redis persistence (full for cluster reliability)
REDIS_SAVE_ENABLED=true
REDIS_SAVE_INTERVAL="900 1 300 10 60 10000"
REDIS_APPENDONLY=yes
REDIS_APPENDFSYNC=everysec

# Redis cluster timeout
REDIS_CLUSTER_NODE_TIMEOUT=5000

# Redis cluster require full coverage (disabled for dev)
REDIS_CLUSTER_REQUIRE_FULL_COVERAGE=no

# ------------------------------------------------------------------------------
# PostgreSQL Configuration - Standard Connections
# ------------------------------------------------------------------------------
# Standard connection limits for multi-application development.

# Maximum number of connections
POSTGRES_MAX_CONNECTIONS=100

# Shared buffers
POSTGRES_SHARED_BUFFERS=256MB

# Effective cache size
POSTGRES_EFFECTIVE_CACHE_SIZE=1GB

# Work memory per operation
POSTGRES_WORK_MEM=8MB

# Maintenance work memory
POSTGRES_MAINTENANCE_WORK_MEM=64MB

# PostgreSQL TLS (optional, disabled by default)
POSTGRES_ENABLE_TLS=false

# ------------------------------------------------------------------------------
# MySQL Configuration
# ------------------------------------------------------------------------------
# MySQL 8.0 configuration for legacy application support.

# MySQL connection limit
MYSQL_MAX_CONNECTIONS=100

# MySQL InnoDB buffer pool
MYSQL_INNODB_BUFFER_POOL_SIZE=256M

# MySQL query cache (disabled in MySQL 8.0+)
MYSQL_QUERY_CACHE_SIZE=0

# MySQL TLS (optional, disabled by default)
MYSQL_ENABLE_TLS=false

# MySQL character set
MYSQL_CHARACTER_SET=utf8mb4
MYSQL_COLLATION=utf8mb4_unicode_ci

# ------------------------------------------------------------------------------
# MongoDB Configuration
# ------------------------------------------------------------------------------
# MongoDB 7 configuration for NoSQL document database needs.

# MongoDB connection limit
MONGODB_MAX_CONNECTIONS=100

# MongoDB cache size (WiredTiger)
MONGODB_CACHE_SIZE_GB=0.5

# MongoDB TLS (optional, disabled by default)
MONGODB_ENABLE_TLS=false

# MongoDB storage engine
MONGODB_STORAGE_ENGINE=wiredTiger

# MongoDB journal
MONGODB_JOURNAL_ENABLED=true

# ------------------------------------------------------------------------------
# RabbitMQ Configuration
# ------------------------------------------------------------------------------
# RabbitMQ message queue configuration.

# RabbitMQ management UI port
RABBITMQ_MANAGEMENT_PORT=15672

# RabbitMQ AMQP port
RABBITMQ_AMQP_PORT=5672

# RabbitMQ memory high watermark (50% of available)
RABBITMQ_VM_MEMORY_HIGH_WATERMARK=0.5

# RabbitMQ disk free limit
RABBITMQ_DISK_FREE_LIMIT=2GB

# RabbitMQ TLS (optional, disabled by default)
RABBITMQ_ENABLE_TLS=false

# RabbitMQ virtual host
RABBITMQ_VHOST=dev_vhost

# ------------------------------------------------------------------------------
# Vault Configuration
# ------------------------------------------------------------------------------
# Standard Vault configuration for secrets management.

VAULT_HEALTH_INTERVAL=60s
VAULT_HEALTH_TIMEOUT=5s
VAULT_HEALTH_RETRIES=5
VAULT_HEALTH_START_PERIOD=30s

# Vault TLS (optional, disabled by default)
VAULT_ENABLE_TLS=false

# ------------------------------------------------------------------------------
# Forgejo Configuration
# ------------------------------------------------------------------------------
# Git server configuration for team development.

# Forgejo domain
FORGEJO_DOMAIN=localhost

# Forgejo HTTP port
FORGEJO_HTTP_PORT=3000

# Forgejo SSH port
FORGEJO_SSH_PORT=2222

# Forgejo runner (enabled for CI/CD)
FORGEJO_RUNNER_ENABLED=true

# Forgejo database
FORGEJO_DB_TYPE=postgres
FORGEJO_DB_HOST=postgres:5432

# ------------------------------------------------------------------------------
# Health Check Configuration
# ------------------------------------------------------------------------------
# Standard health check intervals for production-like behavior.

# PostgreSQL health checks
POSTGRES_HEALTH_INTERVAL=60s
POSTGRES_HEALTH_TIMEOUT=5s
POSTGRES_HEALTH_RETRIES=5
POSTGRES_HEALTH_START_PERIOD=30s

# MySQL health checks
MYSQL_HEALTH_INTERVAL=60s
MYSQL_HEALTH_TIMEOUT=5s
MYSQL_HEALTH_RETRIES=5
MYSQL_HEALTH_START_PERIOD=30s

# MongoDB health checks
MONGODB_HEALTH_INTERVAL=60s
MONGODB_HEALTH_TIMEOUT=5s
MONGODB_HEALTH_RETRIES=5
MONGODB_HEALTH_START_PERIOD=30s

# Redis health checks
REDIS_HEALTH_INTERVAL=60s
REDIS_HEALTH_TIMEOUT=3s
REDIS_HEALTH_RETRIES=5
REDIS_HEALTH_START_PERIOD=20s

# RabbitMQ health checks
RABBITMQ_HEALTH_INTERVAL=60s
RABBITMQ_HEALTH_TIMEOUT=5s
RABBITMQ_HEALTH_RETRIES=5
RABBITMQ_HEALTH_START_PERIOD=30s

# Forgejo health checks
FORGEJO_HEALTH_INTERVAL=60s
FORGEJO_HEALTH_TIMEOUT=5s
FORGEJO_HEALTH_RETRIES=5
FORGEJO_HEALTH_START_PERIOD=40s

# ------------------------------------------------------------------------------
# Logging Configuration
# ------------------------------------------------------------------------------
# Standard logging for development.

# Log level
LOG_LEVEL=info

# Docker logging limits
DOCKER_LOG_MAX_SIZE=10m
DOCKER_LOG_MAX_FILE=3

# ------------------------------------------------------------------------------
# Resource Limits - Standard Allocation
# ------------------------------------------------------------------------------
# Standard resource limits for full development stack.

# PostgreSQL resources
POSTGRES_MEMORY_LIMIT=2G
POSTGRES_MEMORY_RESERVATION=512M
POSTGRES_CPU_LIMIT=2

# MySQL resources
MYSQL_MEMORY_LIMIT=1G
MYSQL_MEMORY_RESERVATION=256M
MYSQL_CPU_LIMIT=1

# MongoDB resources
MONGODB_MEMORY_LIMIT=1G
MONGODB_MEMORY_RESERVATION=256M
MONGODB_CPU_LIMIT=1

# Redis resources (per node)
REDIS_MEMORY_LIMIT=512M
REDIS_MEMORY_RESERVATION=256M
REDIS_CPU_LIMIT=0.5

# RabbitMQ resources
RABBITMQ_MEMORY_LIMIT=512M
RABBITMQ_MEMORY_RESERVATION=256M
RABBITMQ_CPU_LIMIT=1

# Vault resources
VAULT_MEMORY_LIMIT=512M
VAULT_MEMORY_RESERVATION=128M
VAULT_CPU_LIMIT=0.5

# Forgejo resources
FORGEJO_MEMORY_LIMIT=1G
FORGEJO_MEMORY_RESERVATION=256M
FORGEJO_CPU_LIMIT=1.0

# ------------------------------------------------------------------------------
# Feature Flags - Standard Features
# ------------------------------------------------------------------------------
# Enable standard development features (no observability).

# Metrics collection (disabled - no Prometheus in standard)
ENABLE_METRICS=false

# Log aggregation (disabled - no Loki in standard)
ENABLE_LOGS=false

# TLS/SSL (optional, disabled by default)
ENABLE_TLS=false

# Observability pipeline (disabled - no Vector in standard)
ENABLE_OBSERVABILITY=false

# ------------------------------------------------------------------------------
# Network Configuration
# ------------------------------------------------------------------------------
# Network settings for standard profile.

# Colima network address
COLIMA_NETWORK_ADDRESS=true

# Service network subnet
SERVICE_NETWORK_SUBNET=172.20.0.0/16

# ------------------------------------------------------------------------------
# Backup Configuration
# ------------------------------------------------------------------------------
# Backup settings for standard profile.

# Backup retention
BACKUP_RETENTION_DAYS=14

# Backup schedule (daily)
BACKUP_SCHEDULE="0 2 * * *"  # Daily at 2 AM

# Backup compression
BACKUP_COMPRESSION=true

# Backup all databases
BACKUP_POSTGRES=true
BACKUP_MYSQL=true
BACKUP_MONGODB=true

# ------------------------------------------------------------------------------
# Performance Tuning
# ------------------------------------------------------------------------------
# Performance settings optimized for standard development workload.

# PgBouncer connection pooling
PGBOUNCER_POOL_MODE=transaction
PGBOUNCER_DEFAULT_POOL_SIZE=10
PGBOUNCER_MAX_CLIENT_CONN=100
PGBOUNCER_MAX_DB_CONNECTIONS=10

# PostgreSQL autovacuum
POSTGRES_AUTOVACUUM=on
POSTGRES_AUTOVACUUM_MAX_WORKERS=3

# MySQL query optimization
MYSQL_QUERY_CACHE_TYPE=0
MYSQL_SORT_BUFFER_SIZE=4M

# MongoDB write concern
MONGODB_WRITE_CONCERN=1

# Redis tuning
REDIS_TCP_BACKLOG=511
REDIS_TIMEOUT=0
REDIS_TCP_KEEPALIVE=300

# RabbitMQ tuning
RABBITMQ_CHANNEL_MAX=2047
RABBITMQ_HEARTBEAT=60

# ------------------------------------------------------------------------------
# Development Settings
# ------------------------------------------------------------------------------
# Development-specific settings for standard profile.

# Hot reload (disabled for stability)
ENABLE_HOT_RELOAD=false

# Debug mode (disabled for production-like behavior)
DEBUG_MODE=false

# Verbose errors (enabled for debugging)
VERBOSE_ERRORS=true

# ------------------------------------------------------------------------------
# Security Settings - Development Defaults
# ------------------------------------------------------------------------------
# Security settings appropriate for development.

# Allow weak passwords (local development only)
ALLOW_WEAK_PASSWORDS=true

# Disable rate limiting (local development)
ENABLE_RATE_LIMITING=false

# Session timeout (8 hours)
SESSION_TIMEOUT=28800

# ------------------------------------------------------------------------------
# Redis Cluster Initialization
# ------------------------------------------------------------------------------
# After first start, initialize Redis cluster with:
#
#   docker exec dev-redis-1 redis-cli --cluster create \
#     172.20.0.13:6379 172.20.0.16:6379 172.20.0.17:6379 \
#     --cluster-yes -a $REDIS_PASSWORD
#
# Or use management script:
#   ./devstack.py redis-cluster-init
#
# Verify cluster:
#   redis-cli -c -h localhost -p 6379 cluster nodes
#   redis-cli -c -h localhost -p 6379 cluster info
#
# ------------------------------------------------------------------------------

# ------------------------------------------------------------------------------
# Notes
# ------------------------------------------------------------------------------
#
# 1. REDIS CLUSTER:
#    - 3-node cluster with all masters (no replicas in dev)
#    - 16,384 slots distributed across nodes
#    - Requires initialization after first start
#    - Connection: redis-cli -c -h localhost -p 6379 (note the -c flag!)
#
# 2. RESOURCE USAGE:
#    - Total RAM: ~4GB
#    - vault: ~512MB
#    - postgres: ~2GB
#    - mysql: ~1GB
#    - mongodb: ~1GB
#    - redis (3 nodes): ~1.5GB total
#    - rabbitmq: ~512MB
#    - forgejo: ~1GB
#    - pgbouncer: ~50MB
#
# 3. STARTUP TIME:
#    - Expected: 40-50 seconds
#    - Vault: 5-10s to unseal
#    - Databases: 10-15s each
#    - Redis cluster: 15-20s (plus initialization time)
#    - RabbitMQ: 10-15s
#
# 4. USE CASES:
#    - Multi-database application development
#    - Microservices development
#    - Redis cluster testing and development
#    - Message queue integration
#    - Full-featured local development
#
# 5. UPGRADING TO FULL:
#    To add observability (Prometheus, Grafana, Loki, Vector):
#    docker compose --profile full up -d
#    (This keeps standard services running and adds observability)
#
# ==============================================================================
